<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√°lculos - e-Restitui√ß√£o</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/calculos.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="assets/logo_e_restituicao.jpg" alt="e-Restitui√ß√£o" class="sidebar-logo">
                <span class="sidebar-title">e-Restitui√ß√£o</span>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <a href="index.html" class="nav-item">
                        <span class="nav-item-icon">üìä</span>
                        Dashboard
                    </a>
                    <a href="clientes.html" class="nav-item" data-permissao="visualizarTodosClientes,visualizarSeusClientes">
                        <span class="nav-item-icon">üë•</span>
                        Clientes
                    </a>
                    <a href="crm.html" class="nav-item" data-permissao="crmVerTodos">
                        <span class="nav-item-icon">üìã</span>
                        CRM
                    </a>
                </div>
                
                <div class="nav-section" id="navOperacoes">
                    <div class="nav-section-title">Opera√ß√µes</div>
                    <a href="calculos.html" class="nav-item active" data-permissao="realizarCalculos">
                        <span class="nav-item-icon">üßÆ</span>
                        C√°lculos
                    </a>
                    <a href="kit-ir.html" class="nav-item" data-permissao="gerarKitIR">
                        <span class="nav-item-icon">üì¶</span>
                        Kit IR / PDFs
                    </a>
                    <a href="pagamentos.html" class="nav-item" data-permissao="verPagamentos">
                        <span class="nav-item-icon">üí≥</span>
                        Pagamentos
                    </a>
                </div>
                
                <div class="nav-section" id="navParceiro">
                    <div class="nav-section-title">Parceiro</div>
                    <a href="comissoes.html" class="nav-item" data-permissao="verComissoes">
                        <span class="nav-item-icon">üí∞</span>
                        Comiss√µes
                    </a>
                </div>
                
                <div class="nav-section" id="navFinanceiro">
                    <div class="nav-section-title">Financeiro</div>
                    <a href="financeiro.html" class="nav-item" data-permissao="controleFinanceiro">
                        <span class="nav-item-icon">üíµ</span>
                        Controle Financeiro
                    </a>
                    <a href="relatorios.html" class="nav-item" data-permissao="verRelatorios">
                        <span class="nav-item-icon">üìà</span>
                        Relat√≥rios
                    </a>
                </div>
                
                <div class="nav-section" id="navAdmin">
                    <div class="nav-section-title">Administra√ß√£o</div>
                    <a href="usuarios.html" class="nav-item" data-permissao="gerenciarUsuarios">
                        <span class="nav-item-icon">‚öôÔ∏è</span>
                        Usu√°rios
                    </a>
                    <a href="configuracoes.html" class="nav-item" data-permissao="alterarConfiguracoes">
                        <span class="nav-item-icon">üîß</span>
                        Configura√ß√µes
                    </a>
                </div>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="header-title">üßÆ C√°lculos de Restitui√ß√£o</h1>
                
                <div class="header-actions">
                    <div class="user-menu" id="userMenu">
                        <div class="user-avatar" id="userAvatar">AD</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">Carregando...</div>
                            <div class="user-role" id="userRole">-</div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Content -->
            <div class="content">
                <!-- Sele√ß√£o de Cliente -->
                <div class="card card-selecao">
                    <div class="card-header">
                        <h2>1Ô∏è‚É£ Selecionar Cliente</h2>
                    </div>
                    <div class="card-body">
                        <div class="busca-cliente">
                            <input type="text" id="buscaCliente" placeholder="üîç Buscar por nome ou CPF..." class="input-busca">
                            <div id="resultadosBusca" class="resultados-busca"></div>
                        </div>
                        
                        <div id="clienteSelecionado" class="cliente-selecionado" style="display: none;">
                            <div class="cliente-info">
                                <div class="cliente-avatar" id="clienteAvatar">JR</div>
                                <div class="cliente-dados">
                                    <h3 id="clienteNome">-</h3>
                                    <p><strong>CPF:</strong> <span id="clienteCPF">-</span></p>
                                    <p><strong>Data Nasc.:</strong> <span id="clienteNascimento">-</span></p>
                                </div>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="limparCliente()">‚úï Trocar Cliente</button>
                        </div>
                    </div>
                </div>

                <!-- Dados do Processo -->
                <div class="card card-processo" id="cardProcesso" style="display: none;">
                    <div class="card-header">
                        <h2>2Ô∏è‚É£ Dados do Processo</h2>
                        <span class="badge badge-info" id="statusDados">Carregado do cadastro</span>
                    </div>
                    <div class="card-body">
                        <!-- Dados do Processo -->
                        <div class="secao">
                            <h4>üìã Informa√ß√µes do Processo</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>N√∫mero do Processo</label>
                                    <input type="text" id="numeroProcesso" placeholder="0000000-00.0000.0.00.0000">
                                </div>
                                <div class="form-group">
                                    <label>Vara</label>
                                    <input type="text" id="vara" placeholder="Ex: 1¬™ Vara do Trabalho">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Comarca</label>
                                    <input type="text" id="comarca" placeholder="Ex: S√£o Paulo/SP">
                                </div>
                                <div class="form-group">
                                    <label>CNPJ da Reclamada</label>
                                    <input type="text" id="cnpjReclamada" placeholder="00.000.000/0000-00" maxlength="18" data-mascara="cnpj">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nome da Reclamada (Fonte Pagadora)</label>
                                    <input type="text" id="nomeReclamada" placeholder="Nome da empresa reclamada">
                                </div>
                            </div>
                        </div>

                        <!-- Valores Homologados -->
                        <div class="secao">
                            <h4>üí∞ Valores Homologados</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Valor Bruto Homologado *</label>
                                    <input type="text" id="valorBruto" placeholder="R$ 0,00" class="input-moeda">
                                </div>
                                <div class="form-group">
                                    <label>Valor Tribut√°vel *</label>
                                    <input type="text" id="valorTributavel" placeholder="R$ 0,00" class="input-moeda">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>N√∫mero de Meses *</label>
                                    <input type="number" id="numeroMeses" placeholder="Ex: 24" min="1" max="480">
                                    <small>Quantidade de meses de acumula√ß√£o dos rendimentos</small>
                                </div>
                                <div class="form-group">
                                    <label>Valor de INSS Reclamante</label>
                                    <input type="text" id="valorINSS" placeholder="R$ 0,00" class="input-moeda">
                                    <small>Opcional - se houver</small>
                                </div>
                            </div>
                        </div>

                        <!-- Alvar√°s -->
                        <div class="secao">
                            <h4>üìÑ Alvar√°s</h4>
                            <p class="info-text">Informe os alvar√°s de levantamento (valor e data de cada um)</p>
                            <div id="containerAlvaras">
                                <!-- Alvar√°s din√¢micos -->
                            </div>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="adicionarAlvara()">
                                ‚ûï Adicionar Alvar√°
                            </button>
                        </div>

                        <!-- DARFs -->
                        <div class="secao">
                            <h4>üìã DARFs (Imposto Retido)</h4>
                            <p class="info-text">Informe os DARFs pagos (valor e data de cada um)</p>
                            <div id="containerDarfs">
                                <!-- DARFs din√¢micos -->
                            </div>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="adicionarDarf()">
                                ‚ûï Adicionar DARF
                            </button>
                        </div>

                        <!-- Honor√°rios -->
                        <div class="secao">
                            <h4>‚öñÔ∏è Honor√°rios Advocat√≠cios</h4>
                            <p class="info-text">Informe os honor√°rios pagos (valor e ano de pagamento)</p>
                            <div id="containerHonorarios">
                                <!-- Honor√°rios din√¢micos -->
                            </div>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="adicionarHonorario()">
                                ‚ûï Adicionar Honor√°rio
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bot√£o Calcular -->
                <div class="card card-acoes" id="cardAcoes" style="display: none;">
                    <div class="card-body acoes-container">
                        <button class="btn btn-primary btn-lg" id="btnCalcular" onclick="executarCalculo()">
                            üßÆ Executar C√°lculo
                        </button>
                        <button class="btn btn-outline" onclick="limparFormulario()">
                            üóëÔ∏è Limpar Dados
                        </button>
                    </div>
                </div>

                <!-- Resultado do C√°lculo -->
                <div class="card card-resultado" id="cardResultado" style="display: none;">
                    <div class="card-header">
                        <h2>3Ô∏è‚É£ Resultado do C√°lculo</h2>
                        <span class="badge badge-success">‚úÖ Calculado</span>
                    </div>
                    <div class="card-body">
                        <!-- Valor Principal -->
                        <div class="resultado-principal">
                            <div class="resultado-label">Valor a Restituir</div>
                            <div class="resultado-valor" id="valorRestituir">R$ 0,00</div>
                            <div class="resultado-info" id="infoRestituicao">-</div>
                        </div>

                        <!-- Detalhamento -->
                        <div class="resultado-detalhes">
                            <h4>üìä Detalhamento do C√°lculo</h4>
                            <table class="tabela-resultado">
                                <tbody>
                                    <tr>
                                        <td>Total de Rendimentos do Autor</td>
                                        <td class="valor" id="resItem1">-</td>
                                    </tr>
                                    <tr>
                                        <td>Total de DARF Paga</td>
                                        <td class="valor" id="resItem2">-</td>
                                    </tr>
                                    <tr class="destaque">
                                        <td>Total da Causa</td>
                                        <td class="valor" id="resItem3">-</td>
                                    </tr>
                                    <tr>
                                        <td>Rendimentos Bruto (deflacionado)</td>
                                        <td class="valor" id="resItem4">-</td>
                                    </tr>
                                    <tr>
                                        <td>RT Calculados</td>
                                        <td class="valor" id="resItem5">-</td>
                                    </tr>
                                    <tr>
                                        <td>Propor√ß√£o RT</td>
                                        <td class="valor" id="resItem6">-</td>
                                    </tr>
                                    <tr>
                                        <td>Rendimentos Isentos</td>
                                        <td class="valor" id="resItem7">-</td>
                                    </tr>
                                    <tr>
                                        <td>RT Normal</td>
                                        <td class="valor" id="resItem8">-</td>
                                    </tr>
                                    <tr>
                                        <td>Despesas Totais</td>
                                        <td class="valor" id="resItem9">-</td>
                                    </tr>
                                    <tr>
                                        <td>Propor√ß√£o Despesas</td>
                                        <td class="valor" id="resItem10">-</td>
                                    </tr>
                                    <tr class="destaque">
                                        <td>Rendimentos Tribut√°veis (Final)</td>
                                        <td class="valor" id="resItem13">-</td>
                                    </tr>
                                    <tr>
                                        <td>INSS Reclamante</td>
                                        <td class="valor" id="resItem14">-</td>
                                    </tr>
                                    <tr>
                                        <td>IRRF Retido</td>
                                        <td class="valor" id="resItem15">-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- A√ß√µes do Resultado -->
                        <div class="resultado-acoes">
                            <button class="btn btn-success" onclick="salvarCalculo()">
                                üíæ Salvar no Cadastro
                            </button>
                            <button class="btn btn-primary" onclick="gerarPDFs()">
                                üìÑ Gerar PDFs (Esclarecimentos + Planilha RT)
                            </button>
                            <button class="btn btn-outline" onclick="novoCalculo()">
                                üîÑ Novo C√°lculo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Hist√≥rico de C√°lculos -->
                <div class="card card-historico">
                    <div class="card-header">
                        <h2>üìú Hist√≥rico de C√°lculos Recentes</h2>
                    </div>
                    <div class="card-body">
                        <table class="tabela-historico">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Cliente</th>
                                    <th>Processo</th>
                                    <th>Valor Restitui√ß√£o</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaHistorico">
                                <!-- Hist√≥rico din√¢mico -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/calculos.js"></script>
</body>
</html>
